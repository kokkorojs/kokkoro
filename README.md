<div align="center">
    <img src="https://kokkoro.js.org/images/74237509.jpg" width="200" alt="id: 74237509" />
    <h3>kokkoro</h3>
    <br />
    <small> &gt; とある咕咕の QQ 机器人框架 &lt; </small>
</div>

*****

[![priconne redive](https://img.shields.io/badge/%E3%83%97%E3%83%AA%E3%83%B3%E3%82%BB%E3%82%B9%E3%82%B3%E3%83%8D%E3%82%AF%E3%83%88-Re%3ADive-F55291?style=flat-square&labelColor=FAFAFA&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC%2FxhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABSlBMVEX%2F%2F%2F%2F1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH1UpH%2F%2F%2F%2BQAc1iAAAAbHRSTlMAAAtOkbLJzLeYWxYQjev3oyLq%2BnqLtImwT4QF%2BKlKQ44rirqMyAF0KSFGeJKAoUEg8LOivbE1gxMEb1OP1cE9FREGGOPCNxQS5JwcB2x52JedhlItmYLAdSytDDMuZaXLxZaq%2Fj4fcKvZzX%2BVYCqxAAAAAWJLR0QAiAUdSAAAAAd0SU1FB%2BUHAgwRA1G%2Bv8QAAAFESURBVDjLY2CgC2CEAiZmFlY2dg5OLm6YCIoCHl6%2BHCjgFxDEVMAllIMEhEXQFYjmoAExVAXiORhAAlmBZA4WIIVQIC0DE5SVk1eAq1CEK1CCCSmDLFaB8VRhCtSEYULqIAUacCM0oQq04CKsIAXaCFdAFehAuBy6ejL6jIwGhka6xhARE6gCU7i3zMwtLK2sgQwbsJAtVIEdmGcPDjsHRycQ5QwWcoEqcAXz3MAKHN3BlAdYyBOqQAzM8wKKe2s7%2BPiCVPqBhfyhCgIgTgq0DuILZmQMEQq1DoOIhEMVMMP95QoyHh5sObxQBT5wkQiQgkg4NwQW1IEwkSiUgPKHx0U0XE9gTKwunOOGiO44bNHthZxg4jHlE1CTXCC6fKITWqKNQJVPwkz2GskpiPBIxZIvGBnT0jNUMzOzJLIV0TIOjQEAe%2FGzgoDvmDIAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDctMDJUMTI6MTc6MDMrMDM6MDArdontAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA3LTAyVDEyOjE3OjAzKzAzOjAwWisxUQAAAABJRU5ErkJggg%3D%3D)](https://priconne-redive.jp/)
[![qq group](https://img.shields.io/badge/qq-1030982964-12B7F5?style=flat-square&labelColor=FAFAFA&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAA+CAMAAABEH1h2AAACB1BMVEX///8AAADoHx/6rgjnFhb/tQj9/f3/sggEAgLyICD//vztICAGBgbrHx8MDAwJCQn7rwj09PTi4uKbm5uBgYHvICAREREODg79sQgkJCT39/f/+/HExMT3q6tNTU37vTRFMQI4JwIgFgHt7e3r6+vd3d3b29u7u7uwsLDyenp4eHjxc3NZWVn//fj//PTf399vb29UVFQ8PDwuLi76uCUgICDfHh7oGhoYGBgVFRWjcgf6+vrR0dG2traYmJiUlJRqampiYmJXV1dDQ0M2Njbk5OTX19fKysr+5a70lJTyfX1zc3P90Gz+yFBGRkbsRET+vCn6tyLUHBwcHBzDGhqxFxesFxeeFRV4EBD/twjGiwa0fwaodgUbAwMJBgD++PjT09O/v7+xsbGpqamoqKj4p6eJiYloaGgxMTEnJyfv7+/96Ojm5ubq5eX84ODP1NTOzs7Nzc3/wcH4vb34urqioqKKioqCfXTvZWWeY2OMfmCgh1G8l0TdqjrqKirZHR3mHBy3GBiXFBSSExN/EREmERHmDg76sAxVCwtICgr/vQlECQnupwjupgjrpQg4CAjUlAfQkgfMjwbAhga7gwYiBQWJYASAWgR3UwRrSwNiRQMUAgISAgISDQEUDgD/9+X+9uX60dH3sbH94aP94aK/kZG+kJCMjIzzhobwbm7uXl7uWlrpLCyLIqc8AAAEYklEQVRIx62Wd1vaUBTGcxACmIBYRpG2LEFoRcVi0SJaLLV1a927rXV277333nvv/SF7b3JNi+Qm2KfvPyT35Pck57znXg6jKNblYpl/00brTDpWVBRLz1g3LpatnUwXgKSC9GTtYujlq2GBVi/PnT5SAFkqOJIjzEZBVtHcqrgKKFqVC30YqDqsTpesBUHmlC0mXsVsKbN4tbZEFV9PKlXHMMWrhZoXM0wdqeV6VcsMIKgB32ziAfhN+KpBXDWo2VcJotDLt9axGwA2CPWuI8uVKpmTr+Q3MsVFMJFCn8HWuyPbSniSk3L20yDhSeRUK0Dr1/S6mekgwWFasWOkZg0xO+YgjOroLsHtHpKaV6l3lpiBKIUSCQVqAGp24EAKiMxLFPAwzGvppvn+W4UtWCoFwgq4DST1WLdFDYJZ0W3WHpBkU7SNLnXrkM9EBr/3+ZPEyKOHDx+NJJ489/pJNwl9QFPhGhDkfzp8S69D0iMJv7eGn/rF2JpCKh4Qt8v4gxt6S16GLPobD8bFbROg+0YK7Bux6DJ4dDviI5bQnauQbPeO3tHpnBYBdep0d0a9kvEVKl1D8n+RuHc7z+nMu30v8QLnrd43uy9neDTu93m9Pv94xuLl3VT8ULx/8OaYASgyjN0c7I8fouLHjHYjF+8dGLx29/Erw1/cq8d3rw0O9MY59MAxGr3njEmj0Zg4u9Fuinf3nu8fuHDx4oWB/vO93XETWuSE8Jk9FLzZqPkjE8fZ7UYku53DnCRjszy9pZPT5CCuc4ssfsBoygU3GQ/I4sf7znJGzqSIogfO9h2Xo3c5YOz6pb7uc9pqObJaq9We6+67dH0MHLtkcCsIevll6ke1RBBVa351/myZ+vwSBFll8A4QtZf5oBXpzpZSpJXfmqcOvt+J67WX9EJHNh00SztqhYhrW2g70hzMwutBVE2xhK9c+ExxDXmoPgt3g3SaSDjtNAK37EGDVeSi464iAPkjJwSLwSFEOeFz+3iwyaZOSndFi3WllFK67ORdc3hb94jG7VzR3FL6vXTlQVnjerD5c66MQCMOVOIMDPsZqvZj0laJX9KYEUiigKNiOyBN0nEhvr3CgV6SzBxphE5O4iGglY63ojCfFHbH8oV4A8vU4lFsllX8C4zVMmzDQjwIHYXEPn4fDd/HE8sKOyCz69kJTDM4LYjS8CjgAjGYn2Cp86wjKE8HHapzbQC3ZUQ+FsEtHWAUFeIFDyinER9iVLQOD39hmakJD4zr6JzE84ivzzpNEM2r0+VN7YnXeHbe+vfqVjxnv060N5UrwvkfPWiWue/F51kk3MgKnjaGI2Y8MdxHM47nU74C3abTo3lCnzfqA+zgrDsScc86hHllNE8I6dro/LurQ3q902lxDlmGn/neANEb37NhyxBadur1Q1ff0t/e1Nbu8VRVbd5c1dXlOX3q5ImjR0+cPHXa09WF16o8nva2pnzl9MvKlyGVl5Xl5wtPop+y+TWC/jf9BuxZscgeRqlfAAAAAElFTkSuQmCC&logoColor=000000)](https://jq.qq.com/?_wv=1027&k=3hcWCnhq)
[![kokkoro](https://img.shields.io/badge/kokkoro-v0.3.0-57B497?style=flat-square&labelColor=FAFAFA&logo=npm&logoColor=FCAA00)](https://www.npmjs.com/package/kokkoro)
[![node engine](https://img.shields.io/badge/node-%3E%3Dv14-339933?style=flat-square&labelColor=FAFAFA&logo=Node.js)](https://nodejs.org)

> 本项目是一个基于 [oicq](https://github.com/takayama-lily/oicq) 协议库，使用 [TypeScript](https://www.typescriptlang.org/) 语言开发的 [QQ](https://im.qq.com/) 机器人框架

## 介绍

原项目 [yumemi_bot](https://github.com/rumicchi/yumemi_bot) 最初为个人自用 bot，主要围绕 [公主连结☆Re:Dive](https://priconne-redive.jp/) 开发相关功能，因代码严重耦合不利于维护，使用 ts 重构

- [x] 多群插件管理，所有插件针对不同群聊均支持参数自定义
- [x] 默认扫码登录，能有效避免因操作不当导致账号风控、掉线等问题
- [x] 友好的脚手架，无需手动修改配置文件，全由命令自动构建，能防止因修改文件导致占用或缓存而产生的异常
- [x] 支持同步登录，可添加多个账号自由管理（避免在项目启动瞬间登录 **过多账号** ，可能会出现被封号的风险）
- [ ] json 数据库，快速实现本地信息存储 ~~咕咕咕~~
- [ ] web 可扩展性，每个插件均支持扩展独立的 web 页面及路由服务 ~~咕咕咕~~

## 构建

本项目不用安装任何第三方软件，非常简单轻便  
仅需三行命令即可构建，你可以选择下列任意一种方式来初始化你的项目

``` shell
# 全局安装 cli
npm i -g @kokkoro/cli

# 创建并进入文件夹
mkdir bot && cd bot

# 初始化配置文件
kokkoro init
```

or

``` shell
# 创建并进入文件夹
mkdir bot && cd bot

# 本地安装 cli
npm i @kokkoro/cli

# 初始化配置文件
npx kokkoro init
```

> 若网速较慢可以尝试使用阿里镜像源  
> `npm i -g @kokkoro/cli --registry=https://registry.npm.taobao.org`

~~yuki，你为什么不讲下用 yarn 如何安装呀？（这是给小白看的，你 npm 都会用了还需要讲 yarn 么）~~

## 结构

当你输入 `kokkoro init` 后， kokkoro 将会为你在当前所在目录自动安装并生成相关文件

``` text
.
├─ data               资源目录
├─ extensions         扩展目录
├─ main.js            程序入口
└─ kokkoro.yml        配置文件
```

> 项目 **启动后** 尽量避免编辑器直接修改配置文件，你改了也不会生效的，使用指令修改可以立即生效

## 启动

一切准备就绪，开始启动你的项目吧

``` shell
kokkoro start
```

如果你是使用的本地安装，就要使用 `npx kokkoro start` 启动项目

## 指令

登录成功后，你将会收到一条私信（你填写的 masters）  
输入 `print` 指令可以测试消息打印，现在开启一段属于你的物语吧 q(≧▽≦q)

常用指令

| command  | description |
| -------- | ----------- |
| print    | 测试打印 |
| restart  | 重启程序 |
| shutdown | 退出程序 |
| login    | 添加新的登录账号 |
| plugin   | 检索项目所有可用插件 |
| enable   | 为当前 bot 启用插件 |
| disable  | 为当前 bot 禁用插件 |
| reload   | 为当前 bot 重载插件 |
| list     | 列出群聊所有可用插件 |

可以输入 `help` 查看自带的全部指令，安装插件扩展后能使用更多功能

常用插件

| extension | description |
| --------- | ----------- |
| bilibili  | b 站动态订阅 |
| group     | 群管（申请头衔、新人欢迎） |
| guild     | 会战相关 |
| hitokoto  | 每日一言 |
| setu      | hso，我都不看这些的 |
| sandbox   | 将收到的消息当做代码在沙盒中执行 |

使用说明可访问对应仓库地址，开发文档可访问: https://kokkoro.js.org/

## 参数

在初始化项目后，会在根目录下生成 `kokkoro.yml` 文件，你可以在此修改相关配置

#### 什么是 YAML

YAML 是一种专攻配置的语言，可读性高（JSON 有时确实让人眼花缭乱不是么？）  
kokkoro 所有的配置文件均使用 YAML 编写，你也可以 [查看 YAML 入门教程](https://www.runoob.com/w3cnote/yaml-intro.html) 获取相关信息

``` yaml
# web 服务端口号，为 0 则不启用
port: 0
# bot 信息，可添加多个
bots:
  # bot 账号
  "123456789":
    # 项目启动时自动登录，默认 true
    auto_login: true
    # 登录模式，默认扫码登录
    mode: qrcode
    # bot 主人，可添加多个
    masters:
      - 123456789
    # 协议配置，不要随意修改，除非你知道自己在做什么
    protocol:
      # 日志等级，默认 info
      # 打印日志会降低性能，若消息量巨大建议修改此参数
      log_level: info
      # 1:安卓手机(默认) 2:aPad 3:安卓手表 4:MacOS 5:iPad
      platform: 5
      # 忽略自己的消息，默认 true
      ignore_self: true
      # 被风控时是否尝试用分片发送，默认 true
      resend: true
      # 数据存储文件夹
      data_dir: ./data/bot
      # 重新登录间隔，默认5(秒)
      reconn_interval: 5
      # 是否缓存群员列表，默认 true，
      # 群多的时候 (500~1000) 会多占据约 100MB+ 内存
      # 关闭后进程只需不到 20MB 内存
      cache_group_member: true
      # 自动选择最优服务器
      # 关闭后会一直使用 `msfwifi.3g.qq.com:8080` 进行连接
      auto_server: true
```

## 补充

首次登录推荐使用扫码，密码登录需要过滑块验证，非真机环境下抓取 ticket 会失效  
但是扫码登录可能会出现掉线后需要重新扫码的情况，登录一段时间后，不会再弹出滑动验证  
此时建议将 `mode` 改为 `password` 来切换密码登录，更加稳定 φ(≧ω≦*)♪

## 鸣谢

- [oicq](https://github.com/takayama-lily/oicq)
